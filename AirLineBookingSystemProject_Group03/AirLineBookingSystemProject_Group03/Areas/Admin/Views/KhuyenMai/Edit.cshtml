@model AirLineBookingSystemProject_Group03.Models.KHUYENMAI

@{
    ViewBag.Title = "Cập Nhật Khuyến Mãi";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container mt-4" style="max-width: 900px;">
    <div class="card shadow border-0 rounded-3">
        <div class="card-header bg-success text-white py-3" style="background: linear-gradient(135deg, #198754, #146c43);">
            <h5 class="m-0 fw-bold text-uppercase"><i class="fas fa-edit me-2"></i> CẬP NHẬT MÃ: @Model.ID</h5>
        </div>

        <div class="card-body p-4 bg-white">
            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                @Html.HiddenFor(model => model.DASDUNG)

                <div class="row">
                    <div class="col-md-6 border-end">
                        <h6 class="text-success fw-bold mb-3 border-bottom pb-2">Thông tin chung</h6>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Mã Code (ID)</label>
                            @Html.EditorFor(model => model.ID, new { htmlAttributes = new { @class = "form-control fw-bold bg-light text-secondary", @readonly = "readonly" } })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Mô tả</label>
                            @Html.TextAreaFor(model => model.MOTA, new { @class = "form-control", rows = "3" })
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold">Tổng số lượng</label>
                                @Html.EditorFor(model => model.SOLUONG, new { htmlAttributes = new { @class = "form-control" } })
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold text-muted">Đã sử dụng</label>
                                <input type="text" class="form-control bg-light" value="@Model.DASDUNG" readonly />
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Trạng thái</label>
                            <select class="form-select" name="TRANGTHAI">
                                <option value="Hoạt động" @(Model.TRANGTHAI == "Hoạt động" ? "selected" : "")>Hoạt động</option>
                                <option value="Tạm ngưng" @(Model.TRANGTHAI == "Tạm ngưng" ? "selected" : "")>Tạm ngưng</option>
                                <option value="Đã hủy" @(Model.TRANGTHAI == "Đã hủy" ? "selected" : "")>Đã hủy</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6 ps-md-4">
                        <h6 class="text-success fw-bold mb-3 border-bottom pb-2">Giá trị & Thời hạn</h6>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Loại khuyến mãi</label>
                            <select class="form-select fw-bold" id="LoaiKhuyenMai" name="LOAIKHUYENMAI" onchange="toggleHint()">
                                <option value="SoTien" @(Model.LOAIKHUYENMAI == "SoTien" ? "selected" : "")>Giảm theo Số Tiền (VNĐ)</option>
                                <option value="PhanTram" @(Model.LOAIKHUYENMAI == "PhanTram" ? "selected" : "")>Giảm theo Phần Trăm (%)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Giá trị giảm</label>
                            @Html.EditorFor(model => model.GIATRI, new { htmlAttributes = new { @class = "form-control fw-bold text-danger", type = "number", step = "0.01" } })
                            <small class="text-muted fst-italic" id="valueHint">...</small>
                            @Html.ValidationMessageFor(model => model.GIATRI, "", new { @class = "text-danger small" })
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Giảm tối đa</label>
                            @Html.EditorFor(model => model.GIATRITOIDA, new { htmlAttributes = new { @class = "form-control" } })
                        </div>

                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold">Ngày bắt đầu</label>
                                <input type="date" name="NGAYBATDAU" class="form-control"
                                       value="@(Model.NGAYBATDAU.HasValue ? Model.NGAYBATDAU.Value.ToString("yyyy-MM-dd") : "")" required />
                            </div>
                            <div class="col-6 mb-3">
                                <label class="form-label fw-bold">Ngày kết thúc</label>
                                <input type="date" name="NGAYKETTHUC" class="form-control"
                                       value="@(Model.NGAYKETTHUC.HasValue ? Model.NGAYKETTHUC.Value.ToString("yyyy-MM-dd") : "")" required />
                                @Html.ValidationMessageFor(model => model.NGAYKETTHUC, "", new { @class = "text-danger small" })
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-center gap-3 mt-4 pt-3 border-top">
                    <a href="@Url.Action("Index")" class="btn btn-outline-secondary px-4 fw-bold">
                        <i class="fas fa-arrow-left me-2"></i> Quay lại
                    </a>
                    <button type="submit" class="btn btn-warning px-5 fw-bold shadow text-dark">
                        <i class="fas fa-check-circle me-2"></i> LƯU THAY ĐỔI
                    </button>
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        toggleHint();
    });

    function toggleHint() {
        var type = document.getElementById("LoaiKhuyenMai").value;
        var hint = document.getElementById("valueHint");

        if (type === "PhanTram") {
            hint.innerHTML = "<span class='text-danger fw-bold'>Đang chọn % (VD: 0.1 = 10%)</span>";
        } else {
            hint.innerText = "Đang chọn số tiền VNĐ";
        }
    }
</script>